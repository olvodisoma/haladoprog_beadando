<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>{{ mood.name }} ‚Äì Chat</title>
</head>

<body style="background:#111; color:white; font-family:sans-serif; padding:20px;">

<h1>{{ mood.emoji }} {{ mood.name }} AI Chat</h1>
<p>{{ mood.quote }}</p>

<div id="chatbox" style="
    margin-top:20px; 
    background:#222; 
    padding:20px; 
    border-radius:12px;
    height:400px;
    overflow-y:auto;">
</div>

<div style="margin-top:10px;">
    <input id="message" style="width:80%; padding:10px;" placeholder="√çrd be az √ºzeneted...">
    <button onclick="sendMessage()" style="padding:10px;">K√ºld√©s</button>
</div>

<script>
async function sendMessage() {
    const input = document.getElementById("message");
    const text = input.value.trim();
    if (!text) return;

    // helyi bubor√©k hozz√°ad√°sa
    addBubble(text, "user");

    // üî• AZONNAL t√∂r√∂lj√ºk az inputot ‚Äì ez a chatgpt-st√≠lus
    input.value = "";

    try {
        const res = await fetch(`/mood/{{ mood.slug }}/chat`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: text })
        });

        const data = await res.json();

        if (data.reply) {
            addBubble(data.reply, "ai");
        } else {
            addBubble("Hiba t√∂rt√©nt a szerveren.", "ai");
        }

    } catch (e) {
        addBubble("Nem siker√ºlt elk√ºldeni az √ºzenetet.", "ai");
    }
}

function addBubble(text, type) {
    let box = document.getElementById("chatbox");
    let div = document.createElement("div");

    div.style.margin = "10px 0";
    div.style.padding = "10px";
    div.style.borderRadius = "10px";
    div.style.whiteSpace = "pre-wrap";

    if (type === "user") {
        div.style.background = "#3a3";
        div.style.textAlign = "right";
    } else {
        div.style.background = "#333";
        div.style.textAlign = "left";
    }

    div.textContent = text;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
}
</script>

</body>
</html>
